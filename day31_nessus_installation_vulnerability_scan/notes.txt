##############################################
# 🧩 DAY 31 – NESSUS VULNERABILITY SCANNER
##############################################

# ────────────────────────────────
# STEP 1 – Update system packages
# ────────────────────────────────
sudo apt update && sudo apt upgrade -y

# ────────────────────────────────
# STEP 2 – Download Nessus for Ubuntu/Debian
# ────────────────────────────────
wget -O Nessus.deb https://www.tenable.com/downloads/api/v1/public/pages/nessus/downloads/18944/download?i_agree_to_tenable_license_agreement=true

# ────────────────────────────────
# STEP 3 – Install Nessus
# ────────────────────────────────
sudo dpkg -i Nessus.deb || sudo apt -f install -y

# ────────────────────────────────
# STEP 4 – Enable and start Nessus service
# ────────────────────────────────
sudo systemctl enable nessusd.service
sudo systemctl start nessusd.service
sudo systemctl status nessusd --no-pager

# Check listening port (should be 8834)
sudo ss -tulpn | grep nessus

# ────────────────────────────────
# STEP 5 – Register Nessus Essentials
# ────────────────────────────────
# 👉 Get a free activation code here:
#    https://www.tenable.com/products/nessus/nessus-essentials
# Then register below:
sudo /opt/nessus/sbin/nessuscli fetch --register YOUR_ACTIVATION_CODE_HERE

# ────────────────────────────────
# STEP 6 – Create Nessus admin user
# ────────────────────────────────
sudo /opt/nessus/sbin/nessuscli adduser
# → enter username, password, and answer “yes” for admin

# ────────────────────────────────
# STEP 7 – Restart and verify service
# ────────────────────────────────
sudo systemctl restart nessusd
sudo systemctl status nessusd --no-pager
sudo ss -tulpn | grep 8834

# ────────────────────────────────
# STEP 8 – Access Nessus web interface
# ────────────────────────────────
# Local machine:
#   https://localhost:8834/
#
# Remote access options:
#   https://<AWS_PUBLIC_IP>:8834/      (open port 8834 in AWS Security Group)
#   https://<TAILSCALE_IP>:8834/       (if using Tailscale VPN)
#   or via SSH tunnel:
#     ssh -L 8834:localhost:8834 ubuntu@<AWS_PUBLIC_IP>
#     → then open https://localhost:8834 in browser

# ⚠️ Accept browser SSL warning (self-signed cert)

# ────────────────────────────────
# STEP 9 – Verify connectivity
# ────────────────────────────────
curl -k https://localhost:8834
# (You should see an HTML response)

# ────────────────────────────────
# STEP 10 – Run first vulnerability scan
# ────────────────────────────────
# In browser dashboard:
#   + Click “New Scan” → “Basic Network Scan”
#   + Target: your local laptop IP or another server
#   + Save → Launch
#   + View results under “Scans”

##############################################
# ✅ END OF DAY 31 – NESSUS INSTALL & SCAN
##############################################
